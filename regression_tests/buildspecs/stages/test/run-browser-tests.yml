version: 0.2

env:
  parameter-store:
    SLACK_TOKEN: /codebuild/slack_oauth_token

phases:
  install:
    commands:
      - source ./regression_tests/actions/reactivate_virtual_environment.sh
      - ./regression_tests/actions/set_up_aws_config.sh

  build:
    commands:
      # Todo: For a followup pull request, we could install the playwright dependencies in parallel with the environment pipeline so we don't have to wait for them here
      # Todo: Do we really need to install all the browsers in demodjango/tests/browser/run.sh?
      - ./regression_tests/actions/ensure_not_under_maintenance.sh
      - source ./regression_tests/actions/run_demodjango_smoke_tests.sh
      - ./regression_tests/actions/run_maintenance_page_tests.sh

  post_build:
    commands:
      - ./regression_tests/src/send_failure_alerts.sh

artifacts:
  files:
    - '**/*'
