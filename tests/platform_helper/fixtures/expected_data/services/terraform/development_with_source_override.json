{
  "//": "Generated by platform-helper 14.0.0 / 2025-01-16 13:00:00. WARNING: This is an autogenerated file, not for manual editing.",
  "locals": {
    "environment": "development",
    "platform_config": "${yamldecode(file(\"../../../../platform-config.yml\"))}",
    "application": "${local.platform_config[\"application\"]}",
    "environments": "${local.platform_config[\"environments\"]}",
    "env_config": "${{for name, config in local.environments: name => merge(lookup(local.environments, \"*\", {}), config)}}",
    "service_config": "${yamldecode(file(\"./service-config.yml\"))}",
    "raw_env_config": "${local.platform_config[\"environments\"]}",
    "combined_env_config": "${{for name, config in local.raw_env_config: name => merge(lookup(local.raw_env_config, \"*\", {}), config)}}",
    "service_deployment_mode": "${lookup(local.combined_env_config[local.environment], \"service-deployment-mode\", \"copilot\")}",
    "non_copilot_service_deployment_mode": "${local.service_deployment_mode == \"dual-deploy-copilot-traffic\" || local.service_deployment_mode == \"dual-deploy-platform-traffic\" || local.service_deployment_mode == \"platform\" ? 1 : 0}",
    "custom_iam_policy_path": "${abspath(format(\"%s/../../../../services/%s/custom-iam-policy/%s.yml\", path.module, local.service_config.name, local.environment))}",
    "custom_iam_policy_json": "${fileexists(local.custom_iam_policy_path) ? jsonencode(yamldecode(file(local.custom_iam_policy_path))) : null}"
  },
  "provider": {
    "aws": {
      "region": "eu-west-2",
      "profile": "non-prod-acc",
      "allowed_account_ids": ["1122334455"]
    }
  },
  "terraform": {
    "required_version": "~> 1.11",
    "backend": {
      "s3": {
        "bucket": "terraform-platform-state-non-prod-acc",
        "key": "tfstate/application/test-application/services/development/web.tfstate",
        "region": "eu-west-2",
        "encrypt": true,
        "kms_key_id": "alias/terraform-platform-state-s3-key-non-prod-acc",
        "dynamodb_table": "terraform-platform-lockdb-non-prod-acc"
      }
    },
    "required_providers": {
      "aws": {
        "source": "hashicorp/aws",
        "version": "~> 6"
      }
    }
  },
  "module": {
    "ecs-service": {
      "source": "../../../../../platform-tools/terraform/ecs-service",
      "count": "${local.non_copilot_service_deployment_mode}",
      "application": "${local.application}",
      "environment": "${local.environment}",
      "service_config": "${local.service_config}",
      "env_config": "${local.env_config}",
      "platform_extensions": "${local.platform_config[\"extensions\"]}",
      "custom_iam_policy_json": "${local.custom_iam_policy_json}"
    }
  }
}
