{
  "//": "Generated by platform-helper 14.0.0 / 2025-01-16 13:00:00. WARNING: This is an autogenerated file, not for manual editing.",
  "locals": {
    "environment": "development",
    "image_tag": "some-fake-image",
    "platform_config": "${yamldecode(file(\"../../../../platform-config.yml\"))}",
    "application": "${local.platform_config[\"application\"]}",
    "environments": "${local.platform_config[\"environments\"]}",
    "env_config": "${{for name, config in local.environments: name => merge(lookup(local.environments, \"*\", {}), config)}}",
    "service_config": "${yamldecode(templatefile(\"./service-config.yml\", {COPILOT_ENVIRONMENT_NAME = local.environment, IMAGE_TAG = local.image_tag}))}",
    "raw_env_config": "${local.platform_config[\"environments\"]}",
    "combined_env_config": "${{for name, config in local.raw_env_config: name => merge(lookup(local.raw_env_config, \"*\", {}), config)}}",
    "service_deployment_mode": "${lookup(local.combined_env_config[local.environment], \"service-deployment-mode\", \"copilot\")}",
    "non_copilot_service_deployment_mode": "${local.service_deployment_mode == \"dual-deploy-copilot-traffic\" || local.service_deployment_mode == \"dual-deploy-platform-traffic\" || local.service_deployment_mode == \"platform\" ? 1 : 0}",
    "iam-policy-addons_path": "${abspath(format(\"%s/../../../../services/%s/iam-policy-addons/%s.yaml\", path.module, local.service_config.name, local.environment))}",
    "iam_policy_addons_json": "${fileexists(local.iam-policy-addons_path) ? jsonencode(yamldecode(file(local.iam-policy-addons_path))) : null}"
  },
  "provider": {
    "aws": {
      "region": "eu-west-2",
      "profile": "non-prod-acc",
      "alias": "non-prod-acc",
      "shared_credentials_files": [
        "~/.aws/config"
      ]
    }
  },
  "terraform": {
    "required_version": "~> 1.8",
    "backend": {
      "s3": {
        "bucket": "terraform-platform-state-non-prod-acc",
        "key": "tfstate/services/web-development.tfstate",
        "region": "eu-west-2",
        "encrypt": true,
        "kms_key_id": "alias/terraform-platform-state-s3-key-non-prod-acc",
        "dynamodb_table": "terraform-platform-lockdb-non-prod-acc"
      }
    },
    "required_providers": {
      "aws": {
        "source": "hashicorp/aws",
        "version": "~> 5"
      }
    }
  },
  "module": {
    "ecs-service": {
      "source": "git::git@github.com:uktrade/platform-tools.git//terraform/ecs-service?depth=1&ref=10.2.0",
      "count": "${local.non_copilot_service_deployment_mode}",
      "application": "${local.application}",
      "environment": "${local.environment}",
      "service_config": "${local.service_config}",
      "env_config": "${local.env_config}",
      "platform_extensions": "${local.platform_config[\"extensions\"]}",
      "iam_policy_addons_json": "${local.iam_policy_addons_json}"
    }
  }
}