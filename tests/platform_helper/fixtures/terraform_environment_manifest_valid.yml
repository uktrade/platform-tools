# WARNING: This is an autogenerated file, not for manual editing.
# Generated by platform-helper v0.1-TEST / 2023-08-22 16:00:00
locals {
  config = yamldecode(file("../../../platform-config.yml"))
  environments = local.config["environments"]
  env_config   = { for name, config in local.environments : name => merge(lookup(local.environments, "*", {}), config) }
  args = {
    application    = "test-app"
    services       = local.config["extensions"]
    env_config     = local.env_config
  }
}

terraform {
  required_version = "~> 1.8"
  backend "s3" {
    bucket         = "terraform-platform-state-non-prod-acc"
    key            = "tfstate/application/test-app-test-env.tfstate"
    region         = "eu-west-2"
    encrypt        = true
    kms_key_id     = "alias/terraform-platform-state-s3-key-non-prod-acc"
    dynamodb_table = "terraform-platform-lockdb-non-prod-acc"
  }
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5"
    }
  }
}

module "extensions" {
  source = "git::https://github.com/uktrade/terraform-platform-modules.git//extensions?depth=1&ref=123456"

  args        = local.args
  environment = "test-env"
}

/* 
Clean up because terraform modules were initially deployed with a -tf suffix.  This block moves those modules to naming without a suffix.
Can be removed once all services have moved to the new naming.
*/
moved {
  from = module.extensions-tf
  to   = module.extensions
}

